addons:
  ssh_known_hosts: $SERVER_HOSTNAME:$SERVER_PORT

# Handle git submodules yourself
git:
  submodules: false

# Use sed to replace the SSH URL with the public URL, then initialize submodules
before_install:
  - sed -i 's/git@github.com:/https:\/\/github.com\//' .gitmodules
  - git submodule update --init --recursive

script:
  - hugo

before_deploy:
  - openssl aes-256-cbc -K $encrypted_bcf774b7103b_key -iv $encrypted_bcf774b7103b_iv -in travis_rsa.enc -out /tmp/travis_rsa -d
  - eval "$(ssh-agent -s)"
  - chmod 600 /tmp/travis_rsa
  - ssh-add /tmp/travis_rsa

deploy:
  provider: script
  skip_cleanup: true
  script: rsync -az --stats --delete --exclude='files/' -e "ssh -p $SERVER_PORT" ./public/ $SERVER_USERNAME@$SERVER_HOSTNAME:/home/$SERVER_USERNAME/public_html
  on:
    branch: master